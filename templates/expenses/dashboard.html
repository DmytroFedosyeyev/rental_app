{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load i18n %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="mb-3">Добро пожаловать, {{ user.username }}!</h1>
        <p class="lead text-muted">Управляйте своими расходами</p>
    </div>
</div>

<div class="text-center mb-4">
    <label for="year-select" class="me-2 fw-bold">Год:</label>
    <select id="year-select" class="form-select d-inline-block w-auto" onchange="window.location.href='?year=' + this.value">
        {% for y in years %}
            <option value="{{ y }}" {% if y == selected_year %}selected{% endif %}>{{ y }}</option>
        {% endfor %}
    </select>
</div>

<!-- 12 МЕСЯЦЕВ В ОДНОЙ СТРОКЕ -->
<div class="d-flex flex-nowrap overflow-auto gap-3 mb-5 px-1" style="scrollbar-width: thin;">
    {% for month in months %}
        <div class="flex-shrink-0 text-center" style="width: 80px;">
            <a href="{% url 'expenses:month_detail' month.year month.month %}"
               class="btn w-100 h-100 d-flex flex-column justify-content-center align-items-center text-white
                   {% if month.status == 'red' %}btn-danger
                   {% elif month.status == 'green' %}btn-success
                   {% else %}btn-secondary{% endif %}"
               style="height: 70px; font-size: 0.9rem; text-decoration: none; border-radius: 8px;">
                <span class="fw-bold">{{ month.name }}</span>
                <small style="font-size: 0.7rem;">{{ month.year }}</small>
            </a>
        </div>
    {% endfor %}
</div>

<!-- КНОПКИ ДЕЙСТВИЙ -->
<div class="row g-3 mb-5">
    <div class="col-md-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <h5 class="card-title text-primary mb-3">Добавить расход</h5>
                <a href="{% url 'expenses:add_expense' %}?year={{ selected_year }}" class="btn btn-primary">Добавить</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <h5 class="card-title text-success mb-3">Добавить показания</h5>
                <a href="{% url 'expenses:add_meter_reading' %}?year={{ selected_year }}" class="btn btn-success">Добавить</a>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <h5 class="card-title text-warning mb-3">Добавить платёж</h5>
                <a href="{% url 'expenses:add_payment' %}?year={{ selected_year }}" class="btn btn-warning text-dark">Добавить</a>
            </div>
        </div>
    </div>

    <!-- Графики (тоже добавляем year) -->
    <div class="col-md-4">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <h5 class="card-title text-info mb-3">{% trans "Графики потребления" %}</h5>
                <a href="{% url 'expenses:graphs' %}?year={{ selected_year }}" class="btn btn-info text-white">
                    <i class="bi bi-graph-up"></i> Перейти
                </a>
            </div>
        </div>
    </div>
</div>

<!-- СВОДКА ЗА ГОД -->
<div class="row g-3">
    <div class="col-md-3">
        <div class="card text-center shadow-sm h-100">
            <div class="card-body d-flex flex-column justify-content-center">
                <h6 class="text-muted mb-2">Всего расходов</h6>
                <h4 class="text-primary fw-bold">€{{ year_summary.total_amount|floatformat:2 }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center shadow-sm h-100">
            <div class="card-body d-flex flex-column justify-content-center">
                <h6 class="text-muted mb-2">Оплачено</h6>
                <h4 class="text-success fw-bold">€{{ year_summary.total_paid|floatformat:2 }}</h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center shadow-sm h-100">
            <div class="card-body d-flex flex-column justify-content-center">
                <h6 class="text-muted mb-2">Долг</h6>
                <h4 class="fw-bold {% if year_summary.total_debt > 0 %}text-danger{% else %}text-success{% endif %}">
                    €{{ year_summary.total_debt|floatformat:2 }}
                </h4>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-center shadow-sm h-100">
            <div class="card-body d-flex flex-column justify-content-center">
                <h6 class="text-muted mb-2">Кредит</h6>
                <h4 class="text-info fw-bold">€{{ year_summary.credit|floatformat:2 }}</h4>
            </div>
        </div>
    </div>
</div>
{% endblock %}