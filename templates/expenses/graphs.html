{% extends 'base.html' %}
{% load django_bootstrap5 %}

{% block title %}Графики расходов{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1 class="mb-3">Графики расходов</h1>
        <p class="lead text-muted">Анализ потребления за последний год</p>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h5 class="card-title">Холодная вода (м³)</h5>
                <canvas id="coldWaterChart"></canvas>
                <div class="mt-3">
                    <p>Мин: {{ cold_stats.min|floatformat:2 }} м³</p>
                    <p>Макс: {{ cold_stats.max|floatformat:2 }} м³</p>
                    <p>Среднее: {{ cold_stats.avg|floatformat:2 }} м³</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h5 class="card-title">Горячая вода (м³)</h5>
                <canvas id="hotWaterChart"></canvas>
                <div class="mt-3">
                    <p>Мин: {{ hot_stats.min|floatformat:2 }} м³</p>
                    <p>Макс: {{ hot_stats.max|floatformat:2 }} м³</p>
                    <p>Среднее: {{ hot_stats.avg|floatformat:2 }} м³</p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-12">
        <div class="card shadow-sm mb-4">
            <div class="card-body">
                <h5 class="card-title">Электричество (kWh)</h5>
                <canvas id="electricityChart"></canvas>
                <div class="mt-3">
                    <p>Мин: {{ electricity_stats.min|floatformat:2 }} kWh</p>
                    <p>Макс: {{ electricity_stats.max|floatformat:2 }} kWh</p>
                    <p>Среднее: {{ electricity_stats.avg|floatformat:2 }} kWh</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const coldWaterData = {{ chart_data.cold_water|safe }};
    const hotWaterData = {{ chart_data.hot_water|safe }};
    const electricityData = {{ chart_data.electricity|safe }};
    const labels = {{ chart_data.labels|safe }};

    new Chart(document.getElementById('coldWaterChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Холодная вода (м³)',
                data: coldWaterData,
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.5)',
                fill: false,
                tension: 0.1,
                pointRadius: 5
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    new Chart(document.getElementById('hotWaterChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Горячая вода (м³)',
                data: hotWaterData,
                borderColor: '#dc3545',
                backgroundColor: 'rgba(220, 53, 69, 0.5)',
                fill: false,
                tension: 0.1,
                pointRadius: 5
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });

    new Chart(document.getElementById('electricityChart'), {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'Электричество (kWh)',
                data: electricityData,
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.5)',
                fill: false,
                tension: 0.1,
                pointRadius: 5
            }]
        },
        options: {
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}